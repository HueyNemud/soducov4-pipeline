# TÂCHE

## Texte

Le texte à analyser provient de l'OCR d'annuaires commerciaux français (XIXᵉ–XXᵉ siècles).
Le texte est constitué de lignes numérotées suivant le format : `numéro @ texte de la ligne`. On appelle ces numéros `@index` 
Le texte est bruité par l'OCR et contient de très nombreux mots abrégés.

## Entités

- **Entrées d'annuaire** → JSON Entry.
- **Titre de section, de chapitre, etc** → JSON Title.
- **Autre texte isolé** → JSON Text.

Les objets JSON sont décrites dans le schéma fourni.

## Procédure

1. Identifie au sein des lignes ou groupes de lignes consécutives les entrées d'annuaire, titres et autres textes.
2. Extrait les informations selon le schéma JSON défini.
3. Reporte dans le dernier champ d'un objet JSON créé les `@index` des lignes input utilisées pour construire cet objet.

# DIRECTIVES

## Règles d'or

- **toutes** les lignes de l'input doivent être référencées dans l'extraction finale.
- tout fragment de texte de l'input ne peut être utilisé que dans **un seul objet** extrait.
- les `@index` reportés dans un objet doivent **exactement** correspondre aux lignes utilisées pour le construire.
- ne corrige jamais les erreurs OCR et ne résoud jamais les abréviations.
- **crée les entités dans l'ordre exact où elles apparaissent dans le texte**.
- réponds uniquement avec un objet JSON conforme au schéma défini.

## Informations manquantes
- tout champ absent ou vide dans input OCR → valeur JSON null ou []
- **n'invente jamais** d'informations manquantes.
    
## Désambiguïsation

- cas général : 1 ligne correspond à une entité
- cas courant : une entité sur plusieurs lignes consécutives
- cas rare : plusieurs entités sur une seule ligne → créer un objet séparé pour chaque entité. Aide : présence possible d'un délimitateur <br>, | ou autre.
- exception : Texte isolé  = une ligne seule et complète → 1 ligne = 1 entité Text.
- une entrée d'annuaire (Entry) commence **toujours** par le nom de l'entité. Ce nom commence généralement par majuscule, sinon → entrée tronquée, nom manquant. 
- ne jamais omettre une ligne. Si indécision forte → créer une entité `txt`.


## EXEMPLE 1 : 1 entrée tronquée sur 1 ligne

Input:

```
1 @ horl.-bij., député, r. Seine  588 (6°)
```

JSON:

```
[{
  "cat": "ent",
  "name": null,
  "activity": "horl.-bij., député",
  "addresses": [
    {
      "label": " r. Seine",
      "number": "588",
      "complement": "(6°)"
    }
  ],
  "additional_info": [],
  "lines": [
    1
  ]
}]

## EXEMPLE 2 : 1 titre sur 1 ligne

Input:

```
2 @ GRANDS INSTITUTS
```

JSON:

```
[{
  "cat": "title",
  "text": "GRANDS INSTITUTS",
  "lines": [
    2
  ]
}]
```

## EXEMPLE 3 : 1 entrée sur 3 ligne avec infos additionnelles + 2 adresses, avec complément d'adresse 

Input:

```
3 @ Faucon (Vct de), O. 举, directeur de la
4 @ Bourse, sénateur du pays, r. Bourse 20 et 22 bis (7e); bureaux à Chignigneux (Groland).
5 @ TELEPH 9522.22
```

JSON:

```
[{
  "cat": "ent",
  "name": "Faucon (Vct de)",
  "activity": "directeur de la Bourse, sénateur du pays",
  "addresses": [
    {
      "label": "r. Bourse",
      "number": "20 et 22 bis",
      "complement": "(7e)"
    },
    {
      "label": "bureaux à Chignigneux",
      "number": null,
      "complement": "(Groland)"
    }
  ],
  "additional_info": ["O. 举", "TELEPH 9522.22"],
  "lines": [
    3,
    4,
    5
  ]
}]
```

## EXEMPLE 4 : texte isolé

Input:

```
6 @ and the state of the state of the state

```

JSON:

```
[{
  "cat": "txt",
  "text": "and the state of the state of the state",
  "lines": [
    6
  ]
}]
```

## EXEMPLE 5 : 1 entrée non standard sur 1 ligne avec infos additionnelles

Input:

```
7 @ Préfecture, Lyon, Antony. Adr. T 27933. Voyez aussi Hotels de 

```

JSON:

```
[{
  "cat": "ent",
  "name": "Préfecture",
  "activity": null,
  "addresses": [
    {
      "label": "Lyon",
      "number": null,
      "complement": null
    },
    {
      "label": "Antony",
      "number": null,
      "complement": null
    }
  ],
  "additional_info": [
    "Adr. T 27933",
    "Voyez aussi Hotels de"
  ],
  "lines": [
    7
  ]
}]
```

## EXEMPLE 6 : 2 entrées fusionnées sur 1 ligne

⚠️ : réutilisation du même numéro de ligne

Input:

```
8 @ Sryop, manfu., q. Mader 5. <br> Suzanet, m. de march., à Orenj (Josd)

```

JSON:

```
[{
  "cat": "ent",
  "name": "Sryop",
  "activity": "manfu.",
  "addresses": [
    {
      "label": "q. Mader",
      "number": "5",
      "complement": null
    }
  ],
  "additional_info": [],
  "lines": [
    8
  ]
},
{
  "cat": "ent",
  "name": "Suzanet",
  "activity": "m. de march.",
  "addresses": [
    {
      "label": "à Orenj",
      "number": null,
      "complement": "(Josd)"
    }
  ],
  "additional_info": [],
  "lines": [
    8
  ]
}]
```

# INPUT

Le texte OCR à analyser sera fourni dans le message utilisateur suivant.